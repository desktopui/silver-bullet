<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />

  <!-- Enable responsiveness on mobile devices-->
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1.0, maximum-scale=1"
  />

  <title>
     Nuklear &middot; Silver Bullet 
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css" />
  <link rel="stylesheet" href="/public/css/syntax.css" />
  <link rel="stylesheet" href="/public/css/hyde.css" />
  <link
    rel="stylesheet"
    href="http://fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface"
  />

  <!-- Icons -->
  <link
    rel="apple-touch-icon-precomposed"
    sizes="144x144"
    href="/public/apple-touch-icon-144-precomposed.png"
  />
  <link rel="shortcut icon" href="/public/favicon.ico" />

  <!-- RSS -->
  <link
    rel="alternate"
    type="application/rss+xml"
    title="RSS"
    href="//atom.xml"
  />
</head>


  <body class="flexbody">
    <div class="sidebar">
  <div class="container">
    <div class="sidebar-about">
      <h1>
        <a href="/"> Silver Bullet </a>
      </h1>
      <p class="lead">Implementing a chat app in different Desktop GUI frameworks</p>
    </div>

    <nav class="sidebar-nav">
      <a
        class="sidebar-nav-item"
        href="/"
        >Intro</a
      >

              
      <a
        class="sidebar-nav-item"
        href="/about/"
        >About</a
      >
            
      <a
        class="sidebar-nav-item"
        href="/electron/"
        >Electron</a
      >
          
      <a
        class="sidebar-nav-item"
        href="/imgui/"
        >IMGUI</a
      >
          
      <a
        class="sidebar-nav-item"
        href="/"
        >Intro</a
      >
          
      <a
        class="sidebar-nav-item active"
        href="/nuklear/"
        >Nuklear</a
      >
          
      <a
        class="sidebar-nav-item"
        href="/react-native-desktop/"
        >React Native Desktop</a
      >
          

      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >

      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >

      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >

      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >
      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >
      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >
      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >
      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >
      <a
        class="sidebar-nav-item"
        href="/archive/v2.1.0.zip"
        >Download</a
      >

      <a class="sidebar-nav-item" href="">GitHub</a>
    </nav>
  </div>
</div>


    <div class="content container"><div class="page">
  <h1 class="page-title">Nuklear</h1>
  <p><a href="https://github.com/vurtun/nuklear">https://github.com/vurtun/nuklear</a></p>

<p><strong>Build system</strong>: CMake
<strong>Launguage</strong>: C
<strong>Editor</strong>: CLion
<strong>Renderer</strong> Not included, you can add it or copy from examples (GLFW3, GDI2, SDL, X11, etc.)</p>

<p>Another immediate mode GUI. Single-file dependency (On macOS it requires installing <code class="highlighter-rouge">glfw</code>, <code class="highlighter-rouge">glew</code> to compile), plain C, OpenGL.</p>

<p>At first glance it looks like everything that you can expect from it: the rendering is blurry, no accessiblity bridge, no OS-awareness, and like this resizing artifact:</p>

<p><img src="https://user-images.githubusercontent.com/1004115/51437327-fc572400-1cad-11e9-87f8-a8032ffd98e0.gif" alt="nuklear example widget layout problems with window resizing" /></p>

<p>But this is just one example app, the other one from repository (<code class="highlighter-rouge">extended.c</code>) looks better, although, text rendering is still off.</p>

<p><img width="538" alt="Extended example of Nuklear" src="https://user-images.githubusercontent.com/1004115/51789123-e4dcd700-2196-11e9-8fa2-5bd8985538db.png" /></p>

<p>In real life, some issues can be mitigated if you build a very complex app and able to invest into it.</p>

<p>Using a wrapper also nice if you want to write a lot of code, and there are plenty of it, e.g. Rust, Go, Python.</p>

<p>Nuklear, along with <a href="/imgui">IMGUI</a> is an example of <a href="/">Immediate Mode GUI</a>. So the basic idea looks like this:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// draw a frame
</span>    <span class="c1">// react on input
</span>  <span class="p">}</span>
</code></pre></div></div>

<p>Or to be more specific:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="cp">#include "nuklear.h"
#include "nuklear_glfw_gl3.h"
</span>

<span class="c1">// ..
// Event loop
</span><span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">glfwWindowShouldClose</span><span class="p">(</span><span class="n">win</span><span class="p">))</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">nk_begin</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"Demo"</span><span class="p">,</span> <span class="n">nk_rect</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">250</span><span class="p">),</span>
                         <span class="n">NK_WINDOW_BORDER</span> <span class="o">|</span>
                         <span class="n">NK_WINDOW_MOVABLE</span> <span class="o">|</span>
                         <span class="n">NK_WINDOW_SCALABLE</span> <span class="o">|</span>
                         <span class="n">NK_WINDOW_MINIMIZABLE</span> <span class="o">|</span>
                         <span class="n">NK_WINDOW_TITLE</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// ..
</span>    <span class="n">nk_layout_row_static</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="mi">30</span><span class="p">,</span> <span class="mi">80</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">nk_button_label</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="s">"button"</span><span class="p">))</span>
        <span class="n">fprintf</span><span class="p">(</span><span class="n">stdout</span><span class="p">,</span> <span class="s">"button pressed</span><span class="se">\n</span><span class="s">"</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="c1">// ..
</span><span class="p">}</span>
</code></pre></div></div>

<p>So nuklide consists of a bunch of nk_ functions that “draws” something on the screen and handling the input <strong>each frame</strong> using the backend you provided.
In this case it’s <a href="#glfw3">glfw3</a></p>

<p>What does <code class="highlighter-rouge">nk_button_label</code> do? It’s an alias:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">int</span> <span class="nf">nk_button_label</span><span class="p">(</span><span class="k">struct</span> <span class="n">nk_context</span> <span class="o">*</span><span class="n">ctx</span><span class="p">,</span> <span class="k">const</span> <span class="kt">char</span> <span class="o">*</span><span class="n">title</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">nk_button_text</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">title</span><span class="p">,</span> <span class="n">nk_strlen</span><span class="p">(</span><span class="n">title</span><span class="p">));</span>
<span class="p">}</span>
</code></pre></div></div>

<p>…which could be roughly transformed into the following:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
    <span class="c1">// ..
</span>    <span class="cm">/* calculate button content space */</span>
    <span class="n">content</span><span class="o">-&gt;</span><span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">border</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">rounding</span><span class="p">;</span>
    <span class="n">content</span><span class="o">-&gt;</span><span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">padding</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">border</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">rounding</span><span class="p">;</span>
    <span class="n">content</span><span class="o">-&gt;</span><span class="n">w</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">w</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">padding</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">border</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">rounding</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>
    <span class="n">content</span><span class="o">-&gt;</span><span class="n">h</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">h</span> <span class="o">-</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">padding</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">border</span> <span class="o">+</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">rounding</span><span class="o">*</span><span class="mi">2</span><span class="p">);</span>

    <span class="cm">/* execute button behavior */</span>
    <span class="n">bounds</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">x</span> <span class="o">-</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">touch_padding</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">bounds</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">y</span> <span class="o">-</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">touch_padding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>
    <span class="n">bounds</span><span class="p">.</span><span class="n">w</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">w</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">touch_padding</span><span class="p">.</span><span class="n">x</span><span class="p">;</span>
    <span class="n">bounds</span><span class="p">.</span><span class="n">h</span> <span class="o">=</span> <span class="n">r</span><span class="p">.</span><span class="n">h</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">touch_padding</span><span class="p">.</span><span class="n">y</span><span class="p">;</span>

     <span class="k">if</span> <span class="p">(</span><span class="n">nk_input_is_mouse_hovering_rect</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span> <span class="p">{</span>
        <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">NK_WIDGET_STATE_HOVERED</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nk_input_is_mouse_down</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NK_BUTTON_LEFT</span><span class="p">))</span>
            <span class="o">*</span><span class="n">state</span> <span class="o">=</span> <span class="n">NK_WIDGET_STATE_ACTIVE</span><span class="p">;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">nk_input_has_mouse_click_in_rect</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NK_BUTTON_LEFT</span><span class="p">,</span> <span class="n">r</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">ret</span> <span class="o">=</span> <span class="p">(</span><span class="n">behavior</span> <span class="o">!=</span> <span class="n">NK_BUTTON_DEFAULT</span><span class="p">)</span> <span class="o">?</span>
                <span class="n">nk_input_is_mouse_down</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NK_BUTTON_LEFT</span><span class="p">)</span><span class="o">:</span>
                <span class="cp">#ifdef NK_BUTTON_TRIGGER_ON_RELEASE
</span>                <span class="n">nk_input_is_mouse_released</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NK_BUTTON_LEFT</span><span class="p">);</span>
                <span class="cp">#else
</span>                <span class="n">nk_input_is_mouse_pressed</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">NK_BUTTON_LEFT</span><span class="p">);</span>
                <span class="cp">#endif
</span>    <span class="c1">// ..
</span>    <span class="k">if</span> <span class="p">(</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">draw_begin</span><span class="p">)</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">draw_begin</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">userdata</span><span class="p">);</span>
    <span class="n">nk_draw_button_text</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">bounds</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">content</span><span class="p">,</span> <span class="n">state</span><span class="p">,</span> <span class="n">style</span><span class="p">,</span> <span class="n">string</span><span class="p">,</span> <span class="n">len</span><span class="p">,</span> <span class="n">align</span><span class="p">,</span> <span class="n">font</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">style</span><span class="o">-&gt;</span><span class="n">draw_end</span><span class="p">)</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">draw_end</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">style</span><span class="o">-&gt;</span><span class="n">userdata</span><span class="p">);</span>

    <span class="c1">// ..
</span>
</code></pre></div></div>

<p>So far we only see library-specific code, but Nuklear has a lot of backends, and to add one you need to implement a few functions
how to draw geometry on the screen, how handle input devices such as mouses. This is how glfw OpenGL3 specific code looks like:</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// ..
</span><span class="cm">/* iterate over and execute each draw command */</span>
 <span class="n">nk_draw_foreach</span><span class="p">(</span><span class="n">cmd</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">glfw</span><span class="p">.</span><span class="n">ctx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">dev</span><span class="o">-&gt;</span><span class="n">cmds</span><span class="p">)</span>
 <span class="p">{</span>
   <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">elem_count</span><span class="p">)</span>
     <span class="k">continue</span><span class="p">;</span>
   <span class="n">glBindTexture</span><span class="p">(</span><span class="n">GL_TEXTURE_2D</span><span class="p">,</span> <span class="p">(</span><span class="n">GLuint</span><span class="p">)</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">texture</span><span class="p">.</span><span class="n">id</span><span class="p">);</span>
   <span class="n">glScissor</span><span class="p">(</span>
       <span class="p">(</span><span class="n">GLint</span><span class="p">)(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">x</span> <span class="o">*</span> <span class="n">glfw</span><span class="p">.</span><span class="n">fb_scale</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
       <span class="p">(</span><span class="n">GLint</span><span class="p">)((</span><span class="n">glfw</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="p">(</span><span class="n">GLint</span><span class="p">)(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">h</span><span class="p">))</span> <span class="o">*</span> <span class="n">glfw</span><span class="p">.</span><span class="n">fb_scale</span><span class="p">.</span><span class="n">y</span><span class="p">),</span>
       <span class="p">(</span><span class="n">GLint</span><span class="p">)(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">w</span> <span class="o">*</span> <span class="n">glfw</span><span class="p">.</span><span class="n">fb_scale</span><span class="p">.</span><span class="n">x</span><span class="p">),</span>
       <span class="p">(</span><span class="n">GLint</span><span class="p">)(</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">clip_rect</span><span class="p">.</span><span class="n">h</span> <span class="o">*</span> <span class="n">glfw</span><span class="p">.</span><span class="n">fb_scale</span><span class="p">.</span><span class="n">y</span><span class="p">));</span>
   <span class="n">glDrawElements</span><span class="p">(</span><span class="n">GL_TRIANGLES</span><span class="p">,</span> <span class="p">(</span><span class="n">GLsizei</span><span class="p">)</span><span class="n">cmd</span><span class="o">-&gt;</span><span class="n">elem_count</span><span class="p">,</span> <span class="n">GL_UNSIGNED_SHORT</span><span class="p">,</span> <span class="n">offset</span><span class="p">);</span>
   <span class="n">offset</span> <span class="o">+=</span> <span class="n">cmd</span><span class="o">-&gt;</span><span class="n">elem_count</span><span class="p">;</span>
 <span class="p">}</span>
</code></pre></div></div>

<h2 id="accessiblity">Accessiblity</h2>

<p><a href="https://news.ycombinator.com/item?id=16347902">mwcampbell wrote</a></p>

<blockquote>
  <p>Technical follow-up: It seems to me that implementing today’s platform accessibility APIs (e.g. UI Automation for Windows, AT-SPI for Unix) would be difficult if not impractical for an immediate-mode toolkit like this one.
These accessibility APIs expose a tree of UI objects, which the client (e.g. screen reader) can freely navigate and query. This basically assumes that there’s a tree of UI objects in memory, which is the case for all mainstream toolkits as far as I know. But that’s not the case for an immediate-mode toolkit. At least with Nuklear, the content and state of the UI (e.g. the label and current checked state of a checkbox) aren’t stored anywhere in the toolkit’s data structures. So I guess applications would have to play a very active role in implementing accessibility APIs, much more than they would with, say, Qt or even Win32.</p>
</blockquote>

<p>Could we though back the tree itself?</p>

<h2 id="other-issues">Other Issues</h2>

<ul>
  <li>OpenGL is deprecated on macOS</li>
  <li><a href="https://github.com/vurtun/nuklear/issues/504">Dynamic height</a></li>
  <li><a href="https://github.com/vurtun/nuklear/issues/326">Scroll to bottom of a scrollbar</a></li>
</ul>

</div>
</div>
  </body>
</html>
